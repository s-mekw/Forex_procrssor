# Step 2: OHLCモデル実装計画

## 📋 実装チェックリスト

### 1. OHLCモデルの実装
- [ ] TimeFrame Enumの定義（M1, M5, M15, H1, H4, D1）
- [ ] OHLCクラスの基本フィールド定義
- [ ] Float32制約の適用（Step 1と同じパターン）
- [ ] 価格の論理的整合性バリデータ実装
- [ ] プロパティメソッドの実装（range, is_bullish, body_size）
- [ ] to_float32_dict()メソッドの実装

### 2. バリデーション実装
- [ ] 高値 >= 安値の検証
- [ ] 高値 >= 開値・終値の検証
- [ ] 安値 <= 開値・終値の検証
- [ ] シンボル正規化（大文字変換）
- [ ] ボリューム >= 0の検証

### 3. テスト実装（test_ohlc_model.py）
- [ ] 正常系テストケース
  - [ ] 有効なOHLCインスタンス作成
  - [ ] TimeFrame列挙型の動作確認
  - [ ] Float32精度への変換確認
- [ ] バリデーションテスト
  - [ ] 価格整合性チェック（高値・安値の関係）
  - [ ] 不正な価格関係でのエラー
  - [ ] 負の価格・ボリュームでのエラー
- [ ] プロパティテスト
  - [ ] range計算の正確性
  - [ ] is_bullish判定（陽線・陰線）
  - [ ] body_size計算
- [ ] JSON変換テスト
  - [ ] シリアライズ・デシリアライズ
  - [ ] TimeFrame列挙型の変換

## 🎯 品質目標
- テストカバレッジ: 95%以上（Step 1と同等）
- 型チェック: 100%通過
- ドキュメント: 全クラス・メソッドに詳細なdocstring

## 📝 実装の優先順位
1. 基本的なOHLCモデル定義
2. Float32制約とバリデーション
3. テストケースの作成と実行
4. プロパティメソッドの追加
5. ドキュメントの充実

## 🔄 Step 1からの学習事項
- field_validatorのmode='before'でFloat32変換を確実に行う
- ValidationInfoを使用して他フィールドとの相関検証
- numpy.float32を明示的に使用し、精度を保証
- pytest.approxでFloat32精度を考慮した比較
- 包括的なエッジケースのテスト（境界値、異常値）

## ⚡ 実装のポイント
1. **TimeFrame Enum**: 文字列ベースのEnumで拡張性を確保
2. **価格整合性**: 複数フィールド間の論理的関係を厳密に検証
3. **プロパティ**: よく使用される派生値を事前計算
4. **テスト戦略**: パラメトライズドテストで網羅的にカバー